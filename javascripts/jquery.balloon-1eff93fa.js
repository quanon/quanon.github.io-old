/**
 * Hover balloon on elements without css and images.
 *
 * Copyright (c) 2011 Hayato Takenaka
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 * @author: Hayato Takenaka (http://urin.github.com)
 * @version: 0.3.5 - 2013/06/26
**/
!function(t){function e(){this.initialize.apply(this,arguments)}function o(o,i,s){function a(t,e,o,i,n){var s=Math.round(i/1.7320508);e.inactive()["setBorder"+o.camel.pos.f](i)["setBorder"+o.camel.pos.c1](s)["setBorder"+o.camel.pos.c2](s)["set"+o.camel.pos.p1](o.isTopLeft?-i:t.inner[o.size.p])["set"+o.camel.pos.c1](t.inner[o.size.c]/2-s).active().$.css("border-"+o.pos.f+"-color",n)}i.stop(!0,!0);var r,p,l={position:"absolute",height:"0",width:"0",border:"solid 0 transparent"},c=new e(o),d=new e(i);if(d.setTop(-s.offsetY+(s.position&&s.position.indexOf("top")>=0?c.top-d.height:s.position&&s.position.indexOf("bottom")>=0?c.bottom:c.center.top-d.height/2)),d.setLeft(s.offsetX+(s.position&&s.position.indexOf("left")>=0?c.left-d.width:s.position&&s.position.indexOf("right")>=0?c.right:c.center.left-d.width/2)),s.tipSize>0){i.data("outerTip")&&(i.data("outerTip").remove(),i.removeData("outerTip")),i.data("innerTip")&&(i.data("innerTip").remove(),i.removeData("innerTip")),r=new e(t("<div>").css(l).appendTo(i)),p=new e(t("<div>").css(l).appendTo(i));for(var u,f=0;f<n.pos.length;f++){if(u=n.getRelativeNames(f),d.center[u.pos.c1]>=c[u.pos.c1]&&d.center[u.pos.c1]<=c[u.pos.c2])if(0==f%2){if(d[u.pos.o]>=c[u.pos.o]&&d[u.pos.f]>=c[u.pos.f])break}else if(d[u.pos.o]<=c[u.pos.o]&&d[u.pos.f]<=c[u.pos.f])break;u=null}u?(d["set"+u.camel.pos.p1](d[u.pos.p1]+(u.isTopLeft?1:-1)*(s.tipSize-d["border"+u.camel.pos.o])),a(d,r,u,s.tipSize,i.css("border-"+u.pos.o+"-color")),a(d,p,u,s.tipSize-2*d["border"+u.camel.pos.o],i.css("background-color")),i.data("outerTip",r.$).data("innerTip",p.$)):t.each([r.$,p.$],function(){this.remove()})}}function i(e,o){var i=e.data("balloon")&&e.data("balloon").get(0);return!(i&&(i==o.relatedTarget||t.contains(i,o.relatedTarget)))}var n={};n.pos=t.extend(["top","bottom","left","right"],{camel:["Top","Bottom","Left","Right"]}),n.size=t.extend(["height","width"],{camel:["Height","Width"]}),n.getRelativeNames=function(t){var e={pos:{o:t,f:0==t%2?t+1:t-1,p1:0==t%2?t:t-1,p2:0==t%2?t+1:t,c1:2>t?2:0,c2:2>t?3:1},size:{p:2>t?0:1,c:2>t?1:0}},o={};for(var i in e){o[i]||(o[i]={});for(var s in e[i])o[i][s]=n[i][e[i][s]],o.camel||(o.camel={}),o.camel[i]||(o.camel[i]={}),o.camel[i][s]=n[i].camel[e[i][s]]}return o.isTopLeft=o.pos.o==o.pos.p1,o},function(){function o(t,e){if(void 0==e)return o(t,!0),o(t,!1);var i=n.getRelativeNames(e?0:2);return t[i.size.p]=t.$["outer"+i.camel.size.p](),t[i.pos.f]=t[i.pos.o]+t[i.size.p],t.center[i.pos.o]=t[i.pos.o]+t[i.size.p]/2,t.inner[i.pos.o]=t[i.pos.o]+t["border"+i.camel.pos.o],t.inner[i.size.p]=t.$["inner"+i.camel.size.p](),t.inner[i.pos.f]=t.inner[i.pos.o]+t.inner[i.size.p],t.inner.center[i.pos.o]=t.inner[i.pos.f]+t.inner[i.size.p]/2,t}var i={setBorder:function(t,e){return function(i){return this.$.css("border-"+t.toLowerCase()+"-width",i+"px"),this["border"+t]=i,this.isActive?o(this,e):this}},setPosition:function(t,e){return function(i){return this.$.css(t.toLowerCase(),i+"px"),this[t.toLowerCase()]=i,this.isActive?o(this,e):this}}};e.prototype={initialize:function(e){this.$=e,t.extend(!0,this,this.$.offset(),{center:{},inner:{center:{}}});for(var o=0;o<n.pos.length;o++)this["border"+n.pos.camel[o]]=parseInt(this.$.css("border-"+n.pos[o]+"-width"))||0;this.active()},active:function(){return this.isActive=!0,o(this),this},inactive:function(){return this.isActive=!1,this}};for(var s=0;s<n.pos.length;s++)e.prototype["setBorder"+n.pos.camel[s]]=i.setBorder(n.pos.camel[s],2>s),0==s%2&&(e.prototype["set"+n.pos.camel[s]]=i.setPosition(n.pos.camel[s],2>s))}(),t.fn.balloon=function(e){return this.one("mouseenter",function(){var o=t(this),n=this,s=o.unbind("mouseenter",arguments.callee).showBalloon(e).mouseenter(function(t){i(o,t)&&o.showBalloon()}).data("balloon");s&&s.mouseleave(function(e){n==e.relatedTarget||t.contains(n,e.relatedTarget)||o.hideBalloon()}).mouseenter(function(){o.showBalloon()})}).mouseleave(function(e){var o=t(this);i(o,e)&&o.hideBalloon()})},t.fn.showBalloon=function(e){var i,n,s;return(e||!this.data("options"))&&(null==t.balloon.defaults.css&&(t.balloon.defaults.css={}),this.data("options",t.extend(!0,{},t.balloon.defaults,e||{}))),e=this.data("options"),this.each(function(){i=t(this),(s=i.data("offTimer"))&&clearTimeout(s);var a=t.isFunction(e.contents)?e.contents():e.contents||i.attr("title"),r=!(n=i.data("balloon"));r&&(n=t("<div>").append(a)),(e.url||n&&""!=n.html())&&(!r&&a&&a!=n.html()&&n.empty().append(a),i.removeAttr("title"),e.url&&n.load(t.isFunction(e.url)?e.url(this):e.url,function(t,s,a){e.ajaxComplete&&e.ajaxComplete(t,s,a),o(i,n,e)}),r?(n.addClass(e.classname).css(e.css).css({visibility:"hidden",position:"absolute"}).appendTo("body"),i.data("balloon",n),o(i,n,e),n.hide().css("visibility","visible")):o(i,n,e),i.data("onTimer",setTimeout(function(){e.showAnimation?e.showAnimation.apply(n.stop(!0,!0),[e.showDuration]):n.show(e.showDuration,function(){this.style.removeAttribute&&this.style.removeAttribute("filter")})},e.delay)))})},t.fn.hideBalloon=function(){var e,o,i=this.data("options");return this.data("balloon")?this.each(function(){var n=t(this);(e=n.data("onTimer"))&&clearTimeout(e),(o=n.data("offTimer"))&&clearTimeout(o),n.data("offTimer",setTimeout(function(){var t=n.data("balloon");i.hideAnimation?t&&i.hideAnimation.apply(t.stop(!0,!0),[i.hideDuration]):t&&t.stop(!0,!0).hide(i.hideDuration)},i.minLifetime))}):this},t.balloon={defaults:{contents:null,url:null,ajaxComplete:null,classname:null,position:"top",offsetX:0,offsetY:0,tipSize:12,delay:0,minLifetime:200,showDuration:100,showAnimation:null,hideDuration:80,hideAnimation:function(t){this.fadeOut(t)},css:{minWidth:"20px",padding:"5px",borderRadius:"6px",border:"solid 1px #777",boxShadow:"4px 4px 4px #555",color:"#666",backgroundColor:"#efefef",opacity:t.support.opacity?"0.85":null,zIndex:"32767",textAlign:"left"}}}}(jQuery);